---
import Layout from '../../layouts/Layout.astro';
import AuthorCard from '../../components/AuthorCard.astro';
import PostCard from '../../components/PostCard.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  const authors = await getCollection('authors');
  return authors.map(author => ({
    params: { slug: author.id },
    props: { author },
  }));
}) satisfies GetStaticPaths;

const { author } = Astro.props;

// Get all posts by this author
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true && data.author.id === author.id;
});

const sortedPosts = allPosts.sort((a, b) =>
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Layout title={`${author.data.name} - Author - Embedded Linux Blog`}>
  <h1 style="margin-bottom: 2rem;">Author Profile</h1>

  <AuthorCard author={author} />

  <section style="margin-top: 3rem;">
    <h2 style="margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--color-primary);">
      Posts by {author.data.name} ({sortedPosts.length})
    </h2>

    {sortedPosts.length > 0 ? (
      sortedPosts.map(post => (
        <PostCard post={post} />
      ))
    ) : (
      <p style="color: var(--color-text-light); padding: 2rem; text-align: center; background-color: var(--color-bg-alt); border-radius: 0.5rem;">
        No posts yet from this author.
      </p>
    )}
  </section>
</Layout>
