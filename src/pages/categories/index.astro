---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

// Count posts per category
const categoryCounts = new Map<string, number>();
allPosts.forEach(post => {
  const category = post.data.category;
  categoryCounts.set(category, (categoryCounts.get(category) || 0) + 1);
});

// Sort categories alphabetically
const sortedCategories = Array.from(categoryCounts.entries())
  .sort((a, b) => a[0].localeCompare(b[0]));
---

<Layout title="All Categories - Embedded Linux Blog">
  <h1 style="margin-bottom: 2rem;">All Categories</h1>

  <p style="color: var(--color-text-light); margin-bottom: 2rem;">
    Browse posts by category. Click on any category to see all related posts.
  </p>

  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;">
    {sortedCategories.map(([category, count]) => {
      const slug = category.toLowerCase().replace(/\s+/g, '-');
      return (
        <a
          href={`/categories/${slug}`}
          style="padding: 1.5rem; background-color: var(--color-bg-alt); border: 2px solid var(--color-border); border-radius: 0.5rem; text-decoration: none; color: var(--color-text); transition: all 0.2s;"
          onmouseover="this.style.borderColor='var(--color-primary)'; this.style.transform='translateY(-2px)';"
          onmouseout="this.style.borderColor='var(--color-border)'; this.style.transform='translateY(0)';"
        >
          <div style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-primary);">
            {category}
          </div>
          <div style="color: var(--color-text-light);">
            {count} {count === 1 ? 'post' : 'posts'}
          </div>
        </a>
      );
    })}
  </div>
</Layout>
