---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { getLangFromId } from '../../../content/config';
import { useTranslations } from '../../../i18n/utils';

const lang = 'en';
const t = useTranslations(lang);

const allPosts = await getCollection('blog', ({ id, data }) => {
  return data.draft !== true && getLangFromId(id) === lang;
});

// Count posts per tag
const tagCounts = new Map<string, number>();
allPosts.forEach(post => {
  post.data.tags.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// Sort tags by count (descending) then alphabetically
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => {
    if (b[1] !== a[1]) return b[1] - a[1];
    return a[0].localeCompare(b[0]);
  });
---

<Layout title={`${t('tags.all')} - ${t('site.title')}`} lang={lang}>
  <h1 style="margin-bottom: 2rem;">{t('tags.all')}</h1>

  <p style="color: var(--color-text-light); margin-bottom: 2rem;">
    {t('tags.description')}
  </p>

  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
    {sortedTags.map(([tag, count]) => (
      <a
        href={`/en/tags/${tag}`}
        style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background-color: var(--color-bg-alt); border: 1px solid var(--color-border); border-radius: 0.5rem; text-decoration: none; color: var(--color-text); transition: all 0.2s;"
        onmouseover="this.style.borderColor='var(--color-primary)'; this.style.backgroundColor='white';"
        onmouseout="this.style.borderColor='var(--color-border)'; this.style.backgroundColor='var(--color-bg-alt)';"
      >
        <span style="font-weight: 500;">#{tag}</span>
        <span style="background-color: var(--color-primary); color: white; padding: 0.25rem 0.5rem; border-radius: 1rem; font-size: 0.85rem;">
          {count}
        </span>
      </a>
    ))}
  </div>
</Layout>
