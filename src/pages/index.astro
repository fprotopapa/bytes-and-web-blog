---
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';
import { getCollection } from 'astro:content';

// Get all published blog posts, sorted by date (newest first)
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

const sortedPosts = allPosts.sort((a, b) =>
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Get the 5 newest posts for the home page
const recentPosts = sortedPosts.slice(0, 5);
---

<Layout title="Home - Embedded Linux Blog">
  <div style="text-align: center; margin-bottom: 3rem;">
    <h1 style="font-size: 3rem; margin-bottom: 1rem; color: var(--color-text);">
      Welcome to Embedded Linux Blog
    </h1>
    <p style="font-size: 1.25rem; color: var(--color-text-light); max-width: 700px; margin: 0 auto;">
      Your source for embedded Linux, kernel development, build systems, and everything in between.
      Written by experienced engineers for the embedded community.
    </p>
  </div>

  <section>
    <h2 style="margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--color-primary);">
      Latest Posts
    </h2>

    {recentPosts.map(post => (
      <PostCard post={post} />
    ))}

    <div style="text-align: center; margin-top: 2rem;">
      <a
        href="/blog"
        style="display: inline-block; background-color: var(--color-primary); color: white; padding: 0.75rem 2rem; border-radius: 0.5rem; font-weight: 600; text-decoration: none;"
      >
        View All Posts
      </a>
    </div>
  </section>

  <section style="margin-top: 4rem; padding: 2rem; background-color: var(--color-bg-alt); border-radius: 0.5rem;">
    <h2 style="margin-bottom: 1rem;">Topics We Cover</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
      <div>
        <h3 style="color: var(--color-primary); font-size: 1.25rem;">Kernel Development</h3>
        <p style="color: var(--color-text-light);">Device drivers, kernel modules, and low-level programming</p>
      </div>
      <div>
        <h3 style="color: var(--color-primary); font-size: 1.25rem;">Build Systems</h3>
        <p style="color: var(--color-text-light);">Yocto, Buildroot, and custom distribution building</p>
      </div>
      <div>
        <h3 style="color: var(--color-primary); font-size: 1.25rem;">Bootloaders</h3>
        <p style="color: var(--color-text-light);">U-Boot, firmware, and system initialization</p>
      </div>
      <div>
        <h3 style="color: var(--color-primary); font-size: 1.25rem;">Hardware Integration</h3>
        <p style="color: var(--color-text-light);">Device trees, board bring-up, and peripherals</p>
      </div>
    </div>
  </section>
</Layout>
