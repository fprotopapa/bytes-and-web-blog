---
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';
import SchemaOrg from '../components/SchemaOrg.astro';
import { getCollection } from 'astro:content';
import { getLangFromId } from '../content/config';
import { useTranslations } from '../i18n/utils';

const lang = 'pl';
const t = useTranslations(lang);

// Get all published blog posts for Polish, sorted by date (newest first)
const allPosts = await getCollection('blog', ({ id, data }) => {
  return data.draft !== true && getLangFromId(id) === lang;
});

const sortedPosts = allPosts.sort((a, b) =>
  b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Get the 5 newest posts for the home page
const recentPosts = sortedPosts.slice(0, 5);
---

<Layout title={`${t('nav.home')} - ${t('site.title')}`} lang={lang}>
  <SchemaOrg type="WebSite" />

  <div style="max-width: 860px; margin: 0 auto;">
  <!-- Hero Section -->
  <div class="text-center mb-8 sm:mb-12 lg:mb-16">
    <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 leading-tight" style="color: var(--color-text);">
      {t('home.welcome')}
    </h1>
    <p class="text-base sm:text-lg lg:text-xl max-w-3xl mx-auto px-4 leading-relaxed" style="color: var(--color-text-light);">
      {t('home.subtitle')}
      <br />
      {t('home.writtenBy')}
    </p>
  </div>

  <!-- Latest Posts Section -->
  <section class="mb-12 sm:mb-16">
    <h2 class="text-2xl sm:text-3xl font-bold mb-6 pb-2 border-b-2" style="color: var(--color-text); border-color: var(--color-primary);">
      {t('home.latestPosts')}
    </h2>

    <div class="space-y-4 sm:space-y-6">
      {recentPosts.map(post => (
        <PostCard post={post} lang={lang} />
      ))}
    </div>

    <div class="text-center mt-8">
      <a
        href="/blog"
        class="inline-block text-white px-6 sm:px-8 py-3 rounded-lg font-semibold no-underline transition-all duration-200 shadow-md hover:shadow-lg hover:opacity-90"
        style="background-color: var(--color-primary);"
      >
        {t('home.viewAllPosts')}
      </a>
    </div>
  </section>

  <!-- Topics Section -->
  <section class="mt-12 sm:mt-16 p-6 sm:p-8 lg:p-10 rounded-lg" style="background-color: var(--color-bg-alt);">
    <h2 class="text-2xl sm:text-3xl font-bold mb-6 sm:mb-8 text-center sm:text-left" style="color: var(--color-text);">{t('home.topicsTitle')}</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <div class="text-center sm:text-left">
        <h3 class="text-lg sm:text-xl font-semibold mb-2" style="color: var(--color-primary);">{t('home.topic.kernel')}</h3>
        <p class="leading-relaxed" style="color: var(--color-text-light);">{t('home.topic.kernelDesc')}</p>
      </div>
      <div class="text-center sm:text-left">
        <h3 class="text-lg sm:text-xl font-semibold mb-2" style="color: var(--color-primary);">{t('home.topic.buildSystems')}</h3>
        <p class="leading-relaxed" style="color: var(--color-text-light);">{t('home.topic.buildSystemsDesc')}</p>
      </div>
      <div class="text-center sm:text-left">
        <h3 class="text-lg sm:text-xl font-semibold mb-2" style="color: var(--color-primary);">{t('home.topic.bootloaders')}</h3>
        <p class="leading-relaxed" style="color: var(--color-text-light);">{t('home.topic.bootloadersDesc')}</p>
      </div>
      <div class="text-center sm:text-left">
        <h3 class="text-lg sm:text-xl font-semibold mb-2" style="color: var(--color-primary);">{t('home.topic.hardware')}</h3>
        <p class="leading-relaxed" style="color: var(--color-text-light);">{t('home.topic.hardwareDesc')}</p>
      </div>
    </div>
  </section>
  </div>
</Layout>
